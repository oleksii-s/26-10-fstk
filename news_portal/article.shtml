<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Article</title>
    <link rel="icon" type="image/png" sizes="32x32" href="news-icon.png">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="style.css"/>
    <script src="show_date.js"></script>
</head>
<body onload="show_date()">
<div id="wrapper">
    <!--#include file="header.html" -->
    <!--#include file="nav.html" -->
    <div id="heading">
        <h2 id="title"></h2>
    </div>
    <section id="article_section">
        <div id="article"></div><br/>
        <div class='show_comment'><a href="javascript:void(0)" onclick="showHide()">Show comments</a></div><br/><br/>
        <div id="comments" style="display: none;"></div>
    </section>
</div>
<!--#include file="footer.html" -->

<script>
    "use strict";

    getData(show_full_article);

    //function for ajax
    function getData(func, path) {

        var root = "http://jsonplaceholder.typicode.com/posts/";
        var strGET = window.location.search.replace('?id=', '');
        var xhr = new XMLHttpRequest();

        if(path){
            strGET += '/' + path;
        }
        xhr.open("GET", root + strGET, true);
        xhr.onreadystatechange = function()
        {
            if (xhr.readyState != 4) return;

            if (xhr.status != 200) {
                alert(xhr.status + ': ' + xhr.statusText);
            } else {
                try {
                    var data = JSON.parse(xhr.responseText);
                } catch (e) {
                    alert("Invalid answer " + e.message);
                }
                return  func(data);
            }
        };
        xhr.send();
    }

    function show_full_article(data)
    {
        document.getElementById('title').innerHTML = data['title'];
        document.getElementById('article').innerHTML = data['body'];
    }

    function show_comments(data)
    {
        var obj = document.getElementById('comments');
        for(var i=0; i< data.length; i++) {
            var ava = document.createElement('div');
            ava.innerHTML = "<div><img src='ava.png' alt='avatar'></div>";
            var comment = document.createElement('div');
            var email = '<div><span class="email">By ' + data[i]['email'] + '</span><br/><br/>';
            var comment_title = '<span class="comment_title">' + data[i]['name'] + '</span><br/>';
            var comment_body = '<span class="comment_body">' + data[i]['body'] + '</span><br/><br/></div>';
            comment.innerHTML = '<div class="comment">' + ava.innerHTML + email + comment_title + comment_body + '</div>';

            obj.appendChild(comment);
        }
    }

    function showHide()
    {
        var obj = document.getElementById('comments');
        if (obj.style.display != "block") {
            obj.style.display = "block";
        }else obj.style.display = "none";

        getData(show_comments, 'comments');
    }

</script>
</body>
</html>